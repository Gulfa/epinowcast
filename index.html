<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- Inform modern browsers that this page supports both dark and light color schemes,
  and the page author prefers light. --><meta name="color-scheme" content="dark light">
<script>
  // If `prefers-color-scheme` is not supported, fall back to light mode.
  // i.e. In this case, inject the `light` CSS before the others, with
  // no media filter so that it will be downloaded with highest priority.
  if (window.matchMedia("(prefers-color-scheme: dark)").media === "not all") {
    document.documentElement.style.display = "none";
    document.head.insertAdjacentHTML(
      "beforeend",
      "<link id=\"css\" rel=\"stylesheet\" href=\"https://bootswatch.com/3/flatly/bootstrap.css\" onload=\"document.documentElement.style.display = ''\">"
    );
  }
</script><title>Nowcast Right Censored Epidemiological Counts • epinowcast</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- Flatly Theme - Light  --><link id="css-light" rel="stylesheet" href="https://bootswatch.com/3/flatly/bootstrap.css" media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)">
<!-- Darkly Theme - Dark --><link id="css-dark" rel="stylesheet" href="https://bootswatch.com/3/darkly/bootstrap.css" media="(prefers-color-scheme: dark)">
<!-- preferably CSS --><link rel="stylesheet" href="preferably.css">
<link id="css-code-light" rel="stylesheet" href="code-color-scheme-light.css" media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)">
<link id="css-code-dark" rel="stylesheet" href="code-color-scheme-dark.css" media="(prefers-color-scheme: dark)">
<script src="darkswitch.js"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Nowcast Right Censored Epidemiological Counts">
<meta property="og:description" content="Tools to enable flexible and efficient nowcasting of  right
    censored epidemiological counts using a semi-mechanistic method with
    adjustment available for both day of reference and day of report effects. ">
<meta property="og:image" content="samabbott.co.uk/epinowcast/reference/figures/README-unnamed-chunk-8-1.png">
<meta property="og:image:alt" content="An R package for nowcasting right censored epidemiolgical counts">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">epinowcast</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.1.1000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/model-definitions.html">Model definition</a>
    </li>
  </ul>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
          <a href="#" id="css-toggle-btn">
            <span class="fas fa-adjust fa-lg"></span>
          </a>
        </li>
        
        <li>
  <a href="https://github.com/seabbs/epinowcast/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
        
        


      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div class="section level1">
<div class="page-header"><h1 id="nowcast-right-censored-epidemological-counts">Nowcast right censored epidemological counts<a class="anchor" aria-label="anchor" href="#nowcast-right-censored-epidemological-counts"></a>
</h1></div>

<p><a href="https://github.com/seabbs/epinowcast/graphs/contributors" class="external-link"><img src="https://img.shields.io/github/contributors/seabbs/epinowcast" alt="GitHub contributors"></a></p>
<p>This package contains tools to enable flexible and efficient nowcasting of right censored epidemiological counts using a semi-mechanistic method with adjustment available for both day of reference and day of report effects.</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<div class="section level3">
<h3 id="installing-the-package">Installing the package<a class="anchor" aria-label="anchor" href="#installing-the-package"></a>
</h3>
<p>Install the unstable development from GitHub using the following,</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"seabbs/epinowcast"</span>, dependencies <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="installing-cmdstan">Installing CmdStan<a class="anchor" aria-label="anchor" href="#installing-cmdstan"></a>
</h3>
<p>If you don’t already have CmdStan installed then, in addition to installing <code>epinowcast</code>, it is also necessary to install CmdStan using CmdStanR’s <code>install_cmdstan()</code> function to enable model fitting in <code>epinowcast</code>. A suitable C++ toolchain is also required. Instructions are provided in the <a href="https://mc-stan.org/cmdstanr/articles/cmdstanr.html" class="external-link"><em>Getting started with CmdStanR</em></a> vignette. See the <a href="https://mc-stan.org/cmdstanr/" class="external-link">CmdStanR documentation</a> for further details and support.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">cmdstanr</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/cmdstanr/reference/install_cmdstan.html" class="external-link">install_cmdstan</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="quick-start">Quick start<a class="anchor" aria-label="anchor" href="#quick-start"></a>
</h2>
<div class="section level3">
<h3 id="example-data">Example data<a class="anchor" aria-label="anchor" href="#example-data"></a>
</h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://samabbott.co.uk/epinowcast/">epinowcast</a></span><span class="op">)</span>

<span class="va">national_germany_hosp</span> <span class="op">&lt;-</span> <span class="va">germany_covid19_hosp</span>
<span class="va">national_germany_hosp</span> <span class="op">&lt;-</span> <span class="va">national_germany_hosp</span><span class="op">[</span><span class="va">location</span> <span class="op">==</span> <span class="st">"DE"</span><span class="op">]</span>
<span class="va">national_germany_hosp</span> <span class="op">&lt;-</span> <span class="va">national_germany_hosp</span><span class="op">[</span><span class="va">age_group</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="st">"00+"</span><span class="op">]</span>

<span class="va">nat_germany_30_days_ago</span> <span class="op">&lt;-</span>
  <span class="va">national_germany_hosp</span><span class="op">[</span><span class="va">report_date</span> <span class="op">&lt;=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">report_date</span><span class="op">)</span> <span class="op">-</span> <span class="fl">30</span><span class="op">]</span>
<span class="va">nat_germany_30_days_ago</span> <span class="op">&lt;-</span>
  <span class="va">nat_germany_30_days_ago</span><span class="op">[</span><span class="va">reference_date</span> <span class="op">&gt;=</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">reference_date</span><span class="op">)</span> <span class="op">-</span> <span class="fl">30</span><span class="op">)</span><span class="op">]</span>
<span class="va">nat_germany_30_days_ago</span><span class="op">[</span><span class="op">]</span>
<span class="co">#&gt;      reference_date location age_group confirm report_date</span>
<span class="co">#&gt;   1:     2021-08-21       DE       00+      69  2021-08-21</span>
<span class="co">#&gt;   2:     2021-08-22       DE       00+      45  2021-08-22</span>
<span class="co">#&gt;   3:     2021-08-23       DE       00+      28  2021-08-23</span>
<span class="co">#&gt;   4:     2021-08-24       DE       00+     136  2021-08-24</span>
<span class="co">#&gt;   5:     2021-08-25       DE       00+     128  2021-08-25</span>
<span class="co">#&gt;  ---                                                      </span>
<span class="co">#&gt; 492:     2021-08-22       DE       00+     239  2021-09-19</span>
<span class="co">#&gt; 493:     2021-08-23       DE       00+     186  2021-09-20</span>
<span class="co">#&gt; 494:     2021-08-21       DE       00+     323  2021-09-19</span>
<span class="co">#&gt; 495:     2021-08-22       DE       00+     239  2021-09-20</span>
<span class="co">#&gt; 496:     2021-08-21       DE       00+     323  2021-09-20</span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">latest_germany_hosp</span> <span class="op">&lt;-</span> <span class="va">national_germany_hosp</span><span class="op">[</span><span class="va">report_date</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">report_date</span><span class="op">)</span><span class="op">]</span>

<span class="va">latest_germany_hosp</span> <span class="op">&lt;-</span>
  <span class="va">latest_germany_hosp</span><span class="op">[</span><span class="va">reference_date</span> <span class="op">&gt;=</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">reference_date</span><span class="op">)</span> <span class="op">-</span> <span class="fl">60</span><span class="op">)</span><span class="op">]</span>
<span class="va">latest_germany_hosp</span> <span class="op">&lt;-</span>
  <span class="va">latest_germany_hosp</span><span class="op">[</span><span class="va">reference_date</span> <span class="op">&lt;=</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">reference_date</span><span class="op">)</span> <span class="op">-</span> <span class="fl">30</span><span class="op">)</span><span class="op">]</span>
<span class="va">latest_germany_hosp</span><span class="op">[</span><span class="op">]</span>
<span class="co">#&gt;     reference_date location age_group confirm report_date</span>
<span class="co">#&gt;  1:     2021-09-20       DE       00+     146  2021-10-20</span>
<span class="co">#&gt;  2:     2021-09-19       DE       00+     275  2021-10-20</span>
<span class="co">#&gt;  3:     2021-09-18       DE       00+     385  2021-10-20</span>
<span class="co">#&gt;  4:     2021-09-17       DE       00+     412  2021-10-20</span>
<span class="co">#&gt;  5:     2021-09-16       DE       00+     481  2021-10-20</span>
<span class="co">#&gt;  6:     2021-09-15       DE       00+     515  2021-10-20</span>
<span class="co">#&gt;  7:     2021-09-14       DE       00+     431  2021-10-20</span>
<span class="co">#&gt;  8:     2021-09-13       DE       00+     204  2021-10-20</span>
<span class="co">#&gt;  9:     2021-09-12       DE       00+     330  2021-10-20</span>
<span class="co">#&gt; 10:     2021-09-11       DE       00+     482  2021-10-20</span>
<span class="co">#&gt; 11:     2021-09-10       DE       00+     515  2021-10-20</span>
<span class="co">#&gt; 12:     2021-09-09       DE       00+     540  2021-10-20</span>
<span class="co">#&gt; 13:     2021-09-08       DE       00+     615  2021-10-20</span>
<span class="co">#&gt; 14:     2021-09-07       DE       00+     455  2021-10-20</span>
<span class="co">#&gt; 15:     2021-09-06       DE       00+     214  2021-10-20</span>
<span class="co">#&gt; 16:     2021-09-05       DE       00+     360  2021-10-20</span>
<span class="co">#&gt; 17:     2021-09-04       DE       00+     484  2021-10-20</span>
<span class="co">#&gt; 18:     2021-09-03       DE       00+     501  2021-10-20</span>
<span class="co">#&gt; 19:     2021-09-02       DE       00+     541  2021-10-20</span>
<span class="co">#&gt; 20:     2021-09-01       DE       00+     628  2021-10-20</span>
<span class="co">#&gt; 21:     2021-08-31       DE       00+     445  2021-10-20</span>
<span class="co">#&gt; 22:     2021-08-30       DE       00+     227  2021-10-20</span>
<span class="co">#&gt; 23:     2021-08-29       DE       00+     374  2021-10-20</span>
<span class="co">#&gt; 24:     2021-08-28       DE       00+     464  2021-10-20</span>
<span class="co">#&gt; 25:     2021-08-27       DE       00+     479  2021-10-20</span>
<span class="co">#&gt; 26:     2021-08-26       DE       00+     543  2021-10-20</span>
<span class="co">#&gt; 27:     2021-08-25       DE       00+     592  2021-10-20</span>
<span class="co">#&gt; 28:     2021-08-24       DE       00+     468  2021-10-20</span>
<span class="co">#&gt; 29:     2021-08-23       DE       00+     206  2021-10-20</span>
<span class="co">#&gt; 30:     2021-08-22       DE       00+     267  2021-10-20</span>
<span class="co">#&gt; 31:     2021-08-21       DE       00+     345  2021-10-20</span>
<span class="co">#&gt;     reference_date location age_group confirm report_date</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="data-preprocessing-and-model-specification">Data preprocessing and model specification<a class="anchor" aria-label="anchor" href="#data-preprocessing-and-model-specification"></a>
</h3>
<p>Process reported data into format required for <a href="https://samabbott.co.uk/epinowcast/">epinowcast</a> and return in a <a href="https://r-datatable.com" class="external-link">data.table</a>. At this stage specify grouping (i.e age, location) if any.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pobs</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/enw_preprocess_data.html">enw_preprocess_data</a></span><span class="op">(</span><span class="va">nat_germany_30_days_ago</span>, max_delay <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>
<span class="va">pobs</span>
<span class="co">#&gt;                    obs         new_confirm             latest</span>
<span class="co">#&gt; 1: &lt;data.table[495x6]&gt; &lt;data.table[495x8]&gt; &lt;data.table[31x5]&gt;</span>
<span class="co">#&gt;                   diff  reporting_triangle      metareference</span>
<span class="co">#&gt; 1: &lt;data.table[495x8]&gt; &lt;data.table[31x32]&gt; &lt;data.table[31x4]&gt;</span>
<span class="co">#&gt;            metareport time snapshots groups max_delay   max_date</span>
<span class="co">#&gt; 1: &lt;data.table[60x5]&gt;   31        31      1        30 2021-09-20</span></code></pre></div>
<p>Construct an intercept only model for the date of reference.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">reference_effects</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/enw_intercept_model.html">enw_intercept_model</a></span><span class="op">(</span><span class="va">pobs</span><span class="op">$</span><span class="va">metareference</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
<span class="va">reference_effects</span>
<span class="co">#&gt; $fixed</span>
<span class="co">#&gt; $fixed$design</span>
<span class="co">#&gt;   (Intercept)</span>
<span class="co">#&gt; 1           1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $fixed$index</span>
<span class="co">#&gt;  [1] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $random</span>
<span class="co">#&gt; $random$design</span>
<span class="co">#&gt;      (Intercept)</span>
<span class="co">#&gt; attr(,"assign")</span>
<span class="co">#&gt; [1] 0</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $random$index</span>
<span class="co">#&gt; integer(0)</span></code></pre></div>
<p>Construct a model with a random effect for the day of report.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">report_effects</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/enw_day_of_week_model.html">enw_day_of_week_model</a></span><span class="op">(</span><span class="va">pobs</span><span class="op">$</span><span class="va">metareport</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
<span class="va">report_effects</span>
<span class="co">#&gt; $fixed</span>
<span class="co">#&gt; $fixed$design</span>
<span class="co">#&gt;   (Intercept) day_of_weekFriday day_of_weekMonday day_of_weekSaturday</span>
<span class="co">#&gt; 1           1                 0                 0                   1</span>
<span class="co">#&gt; 2           1                 0                 0                   0</span>
<span class="co">#&gt; 3           1                 0                 1                   0</span>
<span class="co">#&gt; 4           1                 0                 0                   0</span>
<span class="co">#&gt; 5           1                 0                 0                   0</span>
<span class="co">#&gt; 6           1                 0                 0                   0</span>
<span class="co">#&gt; 7           1                 1                 0                   0</span>
<span class="co">#&gt;   day_of_weekSunday day_of_weekThursday day_of_weekTuesday day_of_weekWednesday</span>
<span class="co">#&gt; 1                 0                   0                  0                    0</span>
<span class="co">#&gt; 2                 1                   0                  0                    0</span>
<span class="co">#&gt; 3                 0                   0                  0                    0</span>
<span class="co">#&gt; 4                 0                   0                  1                    0</span>
<span class="co">#&gt; 5                 0                   0                  0                    1</span>
<span class="co">#&gt; 6                 0                   1                  0                    0</span>
<span class="co">#&gt; 7                 0                   0                  0                    0</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $fixed$index</span>
<span class="co">#&gt;  [1] 1 2 3 4 5 6 7 1 2 3 4 5 6 7 1 2 3 4 5 6 7 1 2 3 4 5 6 7 1 2 3 4 5 6 7 1 2 3</span>
<span class="co">#&gt; [39] 4 5 6 7 1 2 3 4 5 6 7 1 2 3 4 5 6 7 1 2 3 4</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $random</span>
<span class="co">#&gt; $random$design</span>
<span class="co">#&gt;   fixed sd</span>
<span class="co">#&gt; 1     0  1</span>
<span class="co">#&gt; 2     0  1</span>
<span class="co">#&gt; 3     0  1</span>
<span class="co">#&gt; 4     0  1</span>
<span class="co">#&gt; 5     0  1</span>
<span class="co">#&gt; 6     0  1</span>
<span class="co">#&gt; 7     0  1</span>
<span class="co">#&gt; attr(,"assign")</span>
<span class="co">#&gt; [1] 1 2</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $random$index</span>
<span class="co">#&gt; [1] 1 2 3 4 5 6 7</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="model-fitting">Model fitting<a class="anchor" aria-label="anchor" href="#model-fitting"></a>
</h3>
<p>First compile the model. This step can be left to <code>epinowcast</code> but here we want to use multiple cores per chain to speed up model fitting and so need to compile the model with this feature turned on.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/enw_model.html">enw_model</a></span><span class="op">(</span>threads <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p>We now fit the model and produce a nowcast using this fit. Note that here we use two chains each using two threads as a demonstration but in general using 4 chains is recommended. Also note that here we have silenced fitting progress and potential warning messages for the purposes of keeping this quick start short but in general this should not be done.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>mc.cores <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="va">nowcast</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/epinowcast.html">epinowcast</a></span><span class="op">(</span><span class="va">pobs</span>,
  model <span class="op">=</span> <span class="va">model</span>,
  report_effects <span class="op">=</span> <span class="va">report_effects</span>,
  reference_effects <span class="op">=</span> <span class="va">reference_effects</span>,
  save_warmup <span class="op">=</span> <span class="cn">FALSE</span>, pp <span class="op">=</span> <span class="cn">TRUE</span>,
  chains <span class="op">=</span> <span class="fl">2</span>, threads_per_chain <span class="op">=</span> <span class="fl">2</span>,
  refresh <span class="op">=</span> <span class="fl">0</span>, show_messages <span class="op">=</span> <span class="cn">FALSE</span>
<span class="op">)</span>
<span class="co">#&gt; Init values were only set for a subset of parameters. </span>
<span class="co">#&gt; Missing init values for the following parameters:</span>
<span class="co">#&gt;  - chain 1: logmean_eff, logsd_eff, logmean_sd, logsd_sd</span>
<span class="co">#&gt;  - chain 2: logmean_eff, logsd_eff, logmean_sd, logsd_sd</span>
<span class="co">#&gt; Running MCMC with 2 parallel chains, with 2 thread(s) per chain...</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Chain 1 finished in 54.3 seconds.</span>
<span class="co">#&gt; Chain 2 finished in 55.3 seconds.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Both chains finished successfully.</span>
<span class="co">#&gt; Mean chain execution time: 54.8 seconds.</span>
<span class="co">#&gt; Total execution time: 55.4 seconds.</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="results">Results<a class="anchor" aria-label="anchor" href="#results"></a>
</h3>
<p>Print the output from <a href="https://samabbott.co.uk/epinowcast/">epinowcast</a> which includes diagnostic information, the data used for fitting, and the <code>{cmdstanr</code>} object.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nowcast</span>
<span class="co">#&gt;                    obs         new_confirm             latest</span>
<span class="co">#&gt; 1: &lt;data.table[495x6]&gt; &lt;data.table[495x8]&gt; &lt;data.table[31x5]&gt;</span>
<span class="co">#&gt;                   diff  reporting_triangle      metareference</span>
<span class="co">#&gt; 1: &lt;data.table[495x8]&gt; &lt;data.table[31x32]&gt; &lt;data.table[31x4]&gt;</span>
<span class="co">#&gt;            metareport time snapshots groups max_delay   max_date</span>
<span class="co">#&gt; 1: &lt;data.table[60x5]&gt;   31        31      1        30 2021-09-20</span>
<span class="co">#&gt;                  fit       data  fit_args samples max_rhat</span>
<span class="co">#&gt; 1: &lt;CmdStanMCMC[31]&gt; &lt;list[29]&gt; &lt;list[6]&gt;    2000     1.01</span>
<span class="co">#&gt;    divergent_transitions per_divergent_transitions max_treedepth</span>
<span class="co">#&gt; 1:                     0                         0             7</span>
<span class="co">#&gt;    no_at_max_treedepth per_at_max_treedepth time</span>
<span class="co">#&gt; 1:                1594                0.797 55.4</span></code></pre></div>
<p>Summarise the nowcast for the latest snapshot of data.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">nowcast</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.95</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;     reference_date group location age_group confirm     mean median         sd</span>
<span class="co">#&gt;  1:     2021-08-22     1       DE       00+     239 239.0000    239  0.0000000</span>
<span class="co">#&gt;  2:     2021-08-23     1       DE       00+     186 186.5945    186  0.8132653</span>
<span class="co">#&gt;  3:     2021-08-24     1       DE       00+     437 439.1110    439  1.6208000</span>
<span class="co">#&gt;  4:     2021-08-25     1       DE       00+     539 543.8165    544  2.4955844</span>
<span class="co">#&gt;  5:     2021-08-26     1       DE       00+     509 515.9255    516  3.0314262</span>
<span class="co">#&gt;  6:     2021-08-27     1       DE       00+     442 450.4530    450  3.3520754</span>
<span class="co">#&gt;  7:     2021-08-28     1       DE       00+     412 422.7570    422  3.8971201</span>
<span class="co">#&gt;  8:     2021-08-29     1       DE       00+     322 334.0335    334  4.0547007</span>
<span class="co">#&gt;  9:     2021-08-30     1       DE       00+     204 212.0575    212  3.1180210</span>
<span class="co">#&gt; 10:     2021-08-31     1       DE       00+     409 423.3435    423  4.4768883</span>
<span class="co">#&gt; 11:     2021-09-01     1       DE       00+     535 563.4710    563  6.8376557</span>
<span class="co">#&gt; 12:     2021-09-02     1       DE       00+     475 507.0325    507  7.1272605</span>
<span class="co">#&gt; 13:     2021-09-03     1       DE       00+     444 479.2375    479  7.8459463</span>
<span class="co">#&gt; 14:     2021-09-04     1       DE       00+     437 481.9785    481  9.2393572</span>
<span class="co">#&gt; 15:     2021-09-05     1       DE       00+     310 348.5690    348  8.0037034</span>
<span class="co">#&gt; 16:     2021-09-06     1       DE       00+     190 215.5190    215  6.1416202</span>
<span class="co">#&gt; 17:     2021-09-07     1       DE       00+     395 440.2630    440  9.0525027</span>
<span class="co">#&gt; 18:     2021-09-08     1       DE       00+     518 600.5440    600 13.5078235</span>
<span class="co">#&gt; 19:     2021-09-09     1       DE       00+     433 518.4255    517 14.2038841</span>
<span class="co">#&gt; 20:     2021-09-10     1       DE       00+     395 489.5780    489 15.5306638</span>
<span class="co">#&gt; 21:     2021-09-11     1       DE       00+     365 483.3180    482 18.2377406</span>
<span class="co">#&gt; 22:     2021-09-12     1       DE       00+     239 333.3285    333 15.3855759</span>
<span class="co">#&gt; 23:     2021-09-13     1       DE       00+     147 212.1635    211 12.4643671</span>
<span class="co">#&gt; 24:     2021-09-14     1       DE       00+     324 429.9395    429 17.7580831</span>
<span class="co">#&gt; 25:     2021-09-15     1       DE       00+     313 458.8445    458 23.3267312</span>
<span class="co">#&gt; 26:     2021-09-16     1       DE       00+     289 487.4470    485 31.4180798</span>
<span class="co">#&gt; 27:     2021-09-17     1       DE       00+     203 423.1965    420 37.7128628</span>
<span class="co">#&gt; 28:     2021-09-18     1       DE       00+     144 435.1970    430 52.6164559</span>
<span class="co">#&gt; 29:     2021-09-19     1       DE       00+      73 402.5545    396 67.6122603</span>
<span class="co">#&gt; 30:     2021-09-20     1       DE       00+      23 319.5885    307 86.6744160</span>
<span class="co">#&gt;     reference_date group location age_group confirm     mean median         sd</span>
<span class="co">#&gt;         mad     q5    q95      rhat ess_bulk ess_tail</span>
<span class="co">#&gt;  1:  0.0000 239.00 239.00        NA       NA       NA</span>
<span class="co">#&gt;  2:  0.0000 186.00 188.00 0.9993352 1907.339 1848.293</span>
<span class="co">#&gt;  3:  1.4826 437.00 442.00 1.0004761 1934.512 1780.309</span>
<span class="co">#&gt;  4:  2.9652 540.00 548.00 0.9999210 2054.888 2021.513</span>
<span class="co">#&gt;  5:  2.9652 512.00 521.00 0.9999460 1913.582 1781.123</span>
<span class="co">#&gt;  6:  2.9652 445.00 457.00 1.0006570 2008.863 1960.766</span>
<span class="co">#&gt;  7:  4.4478 417.00 430.00 0.9995221 2087.169 2048.988</span>
<span class="co">#&gt;  8:  4.4478 328.00 341.00 1.0005721 2043.544 1895.895</span>
<span class="co">#&gt;  9:  2.9652 207.00 218.00 1.0007575 1922.449 1741.675</span>
<span class="co">#&gt; 10:  4.4478 417.00 431.00 0.9997743 1952.123 1909.372</span>
<span class="co">#&gt; 11:  7.4130 553.00 575.00 0.9999110 1807.538 1832.177</span>
<span class="co">#&gt; 12:  7.4130 496.00 520.00 1.0006397 2001.027 1661.260</span>
<span class="co">#&gt; 13:  7.4130 467.00 492.00 1.0032509 2001.059 1476.787</span>
<span class="co">#&gt; 14:  8.8956 468.00 498.00 1.0002402 2097.893 1608.648</span>
<span class="co">#&gt; 15:  7.4130 336.00 362.00 0.9998575 2115.660 1759.218</span>
<span class="co">#&gt; 16:  5.9304 206.00 226.00 1.0002556 2048.575 2016.486</span>
<span class="co">#&gt; 17:  8.8956 426.00 456.00 1.0006617 2205.876 1985.698</span>
<span class="co">#&gt; 18: 13.3434 580.00 624.05 1.0002983 2100.999 1996.207</span>
<span class="co">#&gt; 19: 14.8260 496.95 543.00 0.9999375 2253.352 1954.974</span>
<span class="co">#&gt; 20: 15.5673 466.00 517.00 0.9996898 2239.101 2015.250</span>
<span class="co">#&gt; 21: 17.7912 455.00 515.00 1.0010747 2358.748 1884.208</span>
<span class="co">#&gt; 22: 14.8260 309.00 360.05 1.0007746 2252.954 1818.850</span>
<span class="co">#&gt; 23: 11.8608 194.00 235.00 0.9994657 2254.843 1938.465</span>
<span class="co">#&gt; 24: 17.7912 403.00 460.05 0.9996863 2229.229 1808.741</span>
<span class="co">#&gt; 25: 23.7216 422.00 499.00 1.0001601 2325.593 1958.476</span>
<span class="co">#&gt; 26: 31.1346 441.00 542.00 0.9998120 2348.327 1730.851</span>
<span class="co">#&gt; 27: 37.0650 367.00 491.00 1.0000192 2677.325 1890.643</span>
<span class="co">#&gt; 28: 48.9258 360.00 527.05 1.0007903 2186.342 1939.236</span>
<span class="co">#&gt; 29: 66.7170 305.95 520.05 1.0006316 2304.264 1871.054</span>
<span class="co">#&gt; 30: 81.5430 199.00 489.05 1.0004510 2709.136 1480.763</span>
<span class="co">#&gt;         mad     q5    q95      rhat ess_bulk ess_tail</span></code></pre></div>
<p>Plot the summarised nowcast against currently observed data (or optionally more recent data for comparison purposes).</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">nowcast</span>, obs <span class="op">=</span> <span class="va">latest_germany_hosp</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-13-1.png" width="100%"></p>
<p>Plot posterior predictions for observed notifications by date of report as a check of how well the model reproduces the observed data.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">nowcast</span>, type <span class="op">=</span> <span class="st">"posterior"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">reference_date</span><span class="op">)</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-14-1.png" width="100%"></p>
</div>
</div>
<div class="section level2">
<h2 id="citation">Citation<a class="anchor" aria-label="anchor" href="#citation"></a>
</h2>
<p>If using <code>epinowccast</code> in your work please consider citing it using the following,</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="co">#&gt; </span></span>
<span id="cb14-2"><a href="#cb14-2"></a><span class="co">#&gt; To cite epinowcast in publications use:</span></span>
<span id="cb14-3"><a href="#cb14-3"></a><span class="co">#&gt; </span></span>
<span id="cb14-4"><a href="#cb14-4"></a><span class="co">#&gt;   Sam Abbott (2021). epinowcast: Nowcast right censored epidemiological</span></span>
<span id="cb14-5"><a href="#cb14-5"></a><span class="co">#&gt;   count data,</span></span>
<span id="cb14-6"><a href="#cb14-6"></a><span class="co">#&gt; </span></span>
<span id="cb14-7"><a href="#cb14-7"></a><span class="co">#&gt; A BibTeX entry for LaTeX users is</span></span>
<span id="cb14-8"><a href="#cb14-8"></a><span class="co">#&gt; </span></span>
<span id="cb14-9"><a href="#cb14-9"></a><span class="co">#&gt;   @Article{,</span></span>
<span id="cb14-10"><a href="#cb14-10"></a><span class="co">#&gt;     title = {epinowcast: Nowcast right censored epidemiological count data},</span></span>
<span id="cb14-11"><a href="#cb14-11"></a><span class="co">#&gt;     author = {Sam Abbott},</span></span>
<span id="cb14-12"><a href="#cb14-12"></a><span class="co">#&gt;     journal = {Zenodo},</span></span>
<span id="cb14-13"><a href="#cb14-13"></a><span class="co">#&gt;     year = {2021},</span></span>
<span id="cb14-14"><a href="#cb14-14"></a><span class="co">#&gt;   }</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="how-to-make-a-bug-report-or-feature-request">How to make a bug report or feature request<a class="anchor" aria-label="anchor" href="#how-to-make-a-bug-report-or-feature-request"></a>
</h2>
<p>Please briefly describe your problem and what output you expect in an <a href="https://github.com/seabbs/epinowcast/issues" class="external-link">issue</a>. If you have a question, please don’t open an issue. Instead, ask on our <a href="https://github.com/seabbs/epinowcast/discussions/categories/q-a" class="external-link">Q and A page</a>.</p>
</div>
<div class="section level2">
<h2 id="contributing">Contributing<a class="anchor" aria-label="anchor" href="#contributing"></a>
</h2>
<p>We welcome contributions and new contributors! We particularly appreciate help on priority problems in the <a href="https://github.com/seabbs/epinowcast/issues" class="external-link">issues</a>. Please check and add to the issues, and/or add a <a href="https://github.com/seabbs/epinowcast/pulls" class="external-link">pull request</a>.</p>
</div>
<div class="section level2">
<h2 id="code-of-conduct">Code of Conduct<a class="anchor" aria-label="anchor" href="#code-of-conduct"></a>
</h2>
<p>Please note that the <code>forecast.vocs</code> project is released with a <a href="samabbott.co.uk/epinowcast/CODE_OF_CONDUCT.html">Contributor Code of Conduct</a>. By contributing to this project, you agree to abide by its terms.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/seabbs/epinowcast/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/seabbs/epinowcast/issues/" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>

<div class="community">
<h2 data-toc-skip>Community</h2>
<ul class="list-unstyled">
<li><a href="CODE_OF_CONDUCT.html">Code of conduct</a></li>
</ul>
</div>

<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html">Citing epinowcast</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>
<a href="https://www.samabbott.co.uk/" class="external-link">Sam Abbott</a> <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0001-8057-8037" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/seabbs/epinowcast/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/seabbs/epinowcast/workflows/R-CMD-check/badge.svg" alt="R-CMD-check"></a></li>
<li><a href="https://app.codecov.io/gh/seabbs/epinowcast" class="external-link"><img src="https://codecov.io/gh/seabbs/epinowcast/branch/main/graph/badge.svg" alt="Codecov test coverage"></a></li>
</ul>
</div>

  </div>
</div>


      <footer><div class="copyright">
  <p>Developed by .</p>
</div>

<div class="pkgdown">
  <p>Made with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> , using <a href="https://preferably.amirmasoudabdol.name/?source=footer" class="external-link">preferably</a> template.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
